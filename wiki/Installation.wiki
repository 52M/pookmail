== POOKMAIL INSTALLATION ==


= BASE SYSTEM ==

 1. Add the following repositories to /etc/apt/sources.list
 {{{
  deb http://ftp.us.debian.org/debian/ stable main non-free contrib
  deb-src http://ftp.us.debian.org/debian/ stable main non-free contrib
 }}}
 1. apt-get install wget
 1. apt-get install bzip2
 1. apt-get install libncurses5-dev
 1. apt-get install bison
 1. apt-get install flex
 1. Install MySQL 3.23.56
   1. tar xvzf mysql-3.23.56.tar.gz
   1. ./configure --prefix=/usr/local/mysql --with-innodb
   1. make
   1. make install
   1. groupadd mysql
   1. useradd -g mysql mysql
   1. cp support-files/my-medium.cnf /etc/my.cnf
   1. Setup mysql variables in /etc/my.cnf:
   {{{
	set-variable    = max_allowed_packet=16M

	#log-bin

	innodb_data_home_dir = /usr/local/mysql/var/
	innodb_data_file_path = ibdata1:10M:autoextend
	innodb_log_group_home_dir = /usr/local/mysql/var/
	innodb_log_arch_dir = /usr/local/mysql/var/

	set-variable = innodb_buffer_pool_size=16M
	set-variable = innodb_additional_mem_pool_size=2M
   }}}
   1. cd /usr/local/mysql
   1. bin/mysql_install_db --user=mysql
   1. chown -R root  .
   1. chown -R mysql var
   1. chgrp -R mysql .
   1. cp support-files/mysql.server /etc/init.d/mysqld
   1. chmod 755 /etc/init.d/mysqld
   1. cd /etc/rc2.d
   1. ln -s ../init.d/mysqld S99mysqld
   1. add "/usr/local/mysql/lib/mysql" to /etc/ld.so.conf
   1. ldconfig
 1. Install APACHE 1.3.37
   1. wget http://www.apache.org/dist/httpd/apache_1.3.37.tar.gz
   1. tar xvzf apache_1.3.37.tar.gz
   1. ./configure --prefix=/usr/local/apache --enable-module=so --enable-module=proxy --enable-module=rewrite
   1. make
   1. make install
   1. cp /usr/local/apache/bin/apachectl /etc/init.d/httpd
   1. cd /etc/rc2.d
   1. ln -s ../init.d/httpd S99httpd
   1. Configure /usr/local/apache/conf/httpd.conf:
   {{{
	ServerTokens Prod
	ServerAdmin info@pookmail.com
	CustomLog /usr/local/apache/logs/access_log combined
   }}}
 1. Install FreeType 2.1.10
   1. wget http://download.savannah.gnu.org/releases/freetype/freetype-2.1.10.tar.gz
   1. tar xvzf freetype-2.1.10.tar.gz
   1. ./configure
   1. make
   1. make install 
 1. Install LibJPEG 6b
   1. wget ftp://ftp.uu.net/graphics/jpeg/jpegsrc.v6b.tar.gz
   1. tar xvzf jpegsrc.v6b.tar.gz
   1. ./configure --enabled-shared
   1. make
   1. make install
 1. Install ZLib 1.2.3
   1. wget http://heanet.dl.sourceforge.net/sourceforge/libpng/zlib-1.2.3.tar.gz
   1. tar xvzf zlib-1.2.3.tar.gz
   1. ./configure --shared
   1. make
   1. make install
 1. Install LibPNG 1.2.8
   1. wget http://heanet.dl.sourceforge.net/sourceforge/libpng/libpng-1.2.8.tar.bz2
   1. bzip2 -d libpng-1.2.8.tar.bz2
   1. tar xvf libpng-1.2.8.tar
   1. cp scripts/makefile.linux Makefile
   1. make
   1. make install
 1. Install GD 2.0.33
   1. wget http://www.boutell.com/gd/http/gd-2.0.33.tar.gz
   1. tar xvzf gd-2.0.33.tar.gz
   1. ./configure --with-freetype --with-png --with-jpeg
   1. make
   1. make install 
 1. Install PHP 4.4.4
   1. wget http://es.php.net/get/php-4.4.4.tar.gz/from/at.php.net/mirror
   1. tar xvzf php-4.4.4.tar.gz
   1. ./configure   --with-apxs=/usr/local/apache/bin/apxs --enable-safe-mode --enable-magic-quotes --with-mysql --with-gd --with-freetype-dir=/usr/lib --with-ttf --enable-gd-native-ttf --with-zlib-dir=/usr/include
   1. make
   1. make install
   1. cp php.ini-dist /usr/local/lib/php.ini
   1. Setup /usr/local/lib/php.ini:
  {{{
  	include_path = "./"
	file_uploads = Off
	error_reporting = E_PARSE & ~E_ERROR 
   }}}
   1. Add those lines to /usr/local/apache/conf/httpd.conf:
   {{{
	LoadModule php4_module libexec/libphp4.so
	AddModule mod_php4.c
	AddType application/x-httpd-php .php
   }}}


= SOURCE CODE =
 1. Add "127.0.0.1 pookmail pookmail.com www.pookmail.com" to /etc/hosts
 1. Create Pookmail users
   1. groupadd pookmail
   1. useradd -g pookmail pookmail
   1. mkdir /home/pookmail
   1. chown -R pookmail:pookmail /home/pookmail
 1. cd /usr/local
 1. mkdir gatika
 1. chown -R pookmail:pookmail gatika
 1. su - pookmail
 1. cvs checkout -d gatika -r V1_21 gatika
 1. cd /usr/local/gatika/db
 1. /usr/local/mysql/bin/mysql --user=root mysql
 1. mysql> create database gatika;
  {{{
    mysql> GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP 
		ON gatika.* TO 'gatika'@'pookmail'
		IDENTIFIED BY 'g4t1k4';
  }}}
 1. mysql> quit; 
 1. /usr/local/mysql/bin/mysql -u gatika -p gatika -h gatika < gatika.db
 1. Install the Crons
   1. su - pookmail
   1. Add the following lines to crontab:
   {{{
 	59 * * * * 
   }}}
 1. Install the PookMail web interface
   1. Setup /usr/local/apache/conf/httpd.conf
   {{{
	user pookmail
	group pookmail
   }}} 
   1. Add the following line to the bottom of /usr/local/apache/conf/httpd.conf
	Include /usr/local/gatika/doc/conf/httpd.conf
   1. /usr/local/apache/bin/apachectl configtest
   1. /usr/local/apache/bin/apachectl restart